<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Malla Curricular - Licenciatura en Turismo</title>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
<style>
  body {
    background: linear-gradient(135deg, #F7F7F7 0%, #ECECEC 100%);
    font-family: 'Montserrat', Arial, sans-serif;
    margin: 0;
    color: #242424;
  }
  .header {
    background: linear-gradient(90deg, #4DC4ED 60%, #E0F7FA 100%);
    color: #046184;
    text-align: center;
    padding: 2rem 0 1.2rem;
    letter-spacing: 2px;
    border-bottom: 3px solid #80DEEA;
  }
  .header h1 {
    font-size: 2.2rem;
    margin-bottom: 0.3rem;
    letter-spacing:2px;
  }
  .header h2 {
    font-size: 1.15rem;
    font-weight: 400;
    opacity: 0.8;
    margin-bottom: 0.5rem;
  }
  .stats {
    display: flex;
    justify-content: center;
    gap: 2.5rem;
    background: #E0F7FA;
    padding: .8rem 0;
    margin-bottom: 1rem;
    border-bottom: 1px solid #B2EBF2;
    font-size: 1.1rem;
    font-weight: 700;
  }
  .container {
    width: 98vw;
    overflow-x: auto;
    padding: 0 5vw 4rem 5vw;
    box-sizing: border-box;
  }
  .unit {
    margin: 2.5rem 0 3rem 0;
  }
  .unit-title {
    font-size: 1.3rem;
    margin-bottom: .3em;
    font-weight: bold;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    border-left: 7px solid #1AB4E8;
    padding-left: .7em;
    display: inline-block;
    background: #f6fafd;
  }
  .unit-title[data-color="basica"] { border-left-color: #4DD78B; background: #effcf3;}
  .unit-title[data-color="prof"] { border-left-color: #FFD150; background: #FFFBE7;}
  .unit-title[data-color="titu"] { border-left-color: #FF9292; background: #fff1f1;}
  .unit-sems {
    display: flex;
    gap: 1.2rem;
    justify-content: center;
    margin: 1.5rem 0 0 0;
    flex-wrap: nowrap;
    overflow-x: auto;
  }
  .sem-col {
    min-width: 220px;
    background: #eaf9fc;
    padding: 1.2rem 1rem 1.3rem 1rem;
    border-radius: 16px;
    box-shadow: 0 2px 10px #8ecae61c;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .sem-title {
    font-size: 1.15rem;
    font-weight: bold;
    margin-bottom: 0.8rem;
    letter-spacing: 1px;
    text-align: center;
    border-left: 4px solid #008BA3;
    padding-left: .4em;
  }
  /* Colores personalizables por semestre */
  .sem-col[data-sem="pre"]{background:#E0F7FA;}
  .sem-col[data-sem="1"]{background:#E8F5E9;}
  .sem-col[data-sem="2"]{background:#FFF3E0;}
  .sem-col[data-sem="3"]{background:#F3E5F5;}
  .sem-col[data-sem="4"]{background:#FCE4EC;}
  .sem-col[data-sem="5"]{background:#FFFDE7;}
  .sem-col[data-sem="6"]{background:#FFEBEE;}
  .sem-col[data-sem="7"]{background:#E8F5E9;}
  .sem-col[data-sem="8"]{background:#E3F2FD;}
  .sem-col[data-sem="9"]{background:#FAFAFA;}
  .sem-title[data-sem="pre"]{color:#008BA3;}
  .sem-title[data-sem="1"]{color:#1B5E20;}
  .sem-title[data-sem="2"]{color:#EF6C00;}
  .sem-title[data-sem="3"]{color:#6A1B9A;}
  .sem-title[data-sem="4"]{color:#AD1457;}
  .sem-title[data-sem="5"]{color:#FBC02D;}
  .sem-title[data-sem="6"]{color:#C62828;}
  .sem-title[data-sem="7"]{color:#1B5E20;}
  .sem-title[data-sem="8"]{color:#0D47A1;}
  .sem-title[data-sem="9"]{color:#424242;}
  .subjects {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 0.6rem;
  }
  .subject-card {
    background: #fff;
    border-radius: 10px;
    padding: 0.85rem 0.9rem 0.7rem 0.9rem;
    font-size: 1rem;
    margin: 0 auto;
    font-weight: 500;
    box-shadow: 0 2px 4px #b8d8ed0e;
    display: flex;
    align-items: center;
    gap: 0.6em;
    opacity: 1;
    cursor: pointer;
    transition: background 0.15s, outline 0.2s;
    border: 2px solid transparent;
    position: relative;
    min-width: 0;
  }
  .subject-card.approved {
    background: #c7eae0;
    text-decoration: line-through;
    color: #373f47ab;
    opacity: 0.67;
  }
  .subject-card.locked {
    cursor: default;
    background: #E0E0E0 !important;
    color: #929494;
    border: 2px dashed #bababa;
    opacity: 0.74;
    text-decoration: none;
  }
  .subject-icon {
    font-size: 1.1em;
    width: 1.5em;
    text-align: center;
    flex-shrink: 0;
  }
  .subject-label {
    flex:1 1 auto;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space:nowrap;
  }

  .subject-credit {
    font-size: 0.92em;
    color: #169ec3;
    margin-left: .4em;
    font-weight: 600;
  }
  .subject-card.locked .subject-credit {color: #bababa;}
  .subject-card .subject-check {
    font-size: 1.12em;
    color: #00b36c;
    display: none;
  }
  .subject-card.approved .subject-check {
    display: inline;
  }
  .subject-card.locked .subject-check {
    display: none;
  }

  .subject-card[data-tooltip]:hover:after,
  .subject-card[data-tooltip]:focus:after{
    content: attr(data-tooltip);
    position: absolute;
    left: 100%;
    top: 50%;
    transform: translateY(-50%);
    background: #333a;
    color: #fff;
    font-size: 0.96em;
    border-radius:6px;
    padding:.4em .8em;
    white-space:pre-line;
    min-width:125px;
    z-index: 3;
    pointer-events: none;
    filter:drop-shadow(2px 7px 5px #0002)
  }
  /* Módulos */
  .modules-section {
    margin: 2.5rem 0 2.5rem 0;
    background: #EFEFEF;
    padding: 2rem 1vw;
    border-radius: 20px;
    box-shadow: 0 3px 12px #c0c9ce0d;
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width:1050px;
    margin-left:auto;margin-right:auto;
  }
  .modules-title {
    font-size: 1.25rem;
    margin-bottom:1.3rem;
    font-weight: bolder;
    color: #2b5c7d;
    background: #eaf6fa;
    padding:.4em 1.2em;
    border-left: 7px solid #006064;
    border-radius: 5px 0 0 5px;
  }
  .modules-container {
    width:100%;
    display: flex;
    justify-content: center;
    gap: 2.3rem;
    margin: .4rem .3rem 0 .3rem;
    flex-wrap:wrap;
  }
  .module-box {
    padding: 1.3em 0.7em;
    border-radius: 13px;
    min-width:220px;
    background:#E5E5E5;
    box-shadow: 0 2px 6px #cacaca25;
    text-align: center;
    transition: box-shadow 0.19s;
    margin-bottom: 1.8em;
  }
  .module-box[data-mod="ing"]{background: #E0F7FA;}
  .module-box[data-mod="comp"]{background: #F3E5F5;}
  .module-title {
    font-size:1.1em;
    font-weight:bolder;
    margin-bottom: .7em;
    color:#006064;
    letter-spacing:1.3px;
  }
  .module-title[data-mod="comp"]{color: #6A1B9A;}
  .module-list {
    display: flex;
    flex-direction: column;
    gap: .65em;
  }
  .module-card {
    background: #fff;
    border-radius: 8px;
    font-size: 1em;
    margin-bottom:.15em;
    display: flex;
    align-items: center;
    gap: .7em;
    padding: .75em 1em;
    box-shadow:0 2px 7px #e4e4e44e;
    cursor: pointer;
    font-weight: 500;
    border:2px solid transparent;
    position: relative;
  }
  .module-card.approved {
    background: #d6f5ec;
    color: #4d6363;
    text-decoration: line-through;
    opacity:0.68;
  }
  .module-card.locked {
    background: #DCDCDC;
    color: #a0a0a0;
    cursor: default;
    border:2px dashed #aeaeae;
    text-decoration:none;
    opacity:0.81
  }
  .module-card.locked .mod-check {display:none;}
  .mod-icon{font-size:1.1em}
  .mod-label{flex:1}
  .mod-credit{
    font-size:.92em;
    color:#009688;
    font-weight:600;
    margin-left:.23em;
    letter-spacing:.5px;
  }
  .module-card.approved .mod-label{color:#278052}
  .module-card .mod-check {
    font-size: 1.1em;
    color:#009688;
    margin-left: .5em;
    display:none;
  }
  .module-card.approved .mod-check{display:inline;}
  .module-card[data-tooltip]:hover:after,
  .module-card[data-tooltip]:focus:after{
    content: attr(data-tooltip);
    position: absolute;
    left: 100%;
    top: 55%;
    transform: translateY(-50%);
    background: #2c2c2ca8;
    color: #fff;
    font-size: 0.99em;
    border-radius:7px;
    padding:.3em .7em;
    white-space:pre-line;
    min-width:145px;
    z-index:10;
    filter:drop-shadow(2px 7px 5px #0002)
  }
  /* Responsive */
  @media (max-width: 900px){
    .unit-sems,.modules-container { flex-wrap:wrap;}
    .sem-col,.module-box{min-width:180px;max-width:100%;}
  }
  @media (max-width:700px){
    .container{padding:0 1vw;}
    .module-box,.sem-col{min-width:98vw;}
    body{font-size:93%;}
    .unit-title{font-size:1.1rem}
  }
</style>
</head>
<body>
  <div class="header">
    <h1>LICENCIATURA EN TURISMO</h1>
    <h2>Malla curricular interactiva con créditos y prerequisitos</h2>
  </div>
  <div class="stats" id="stats">
    <span><span id="aprobadas">0</span>/57 Materias aprobadas</span>
    <span><span id="creditos">0</span> Créditos</span>
    <span><span id="mod_ap">0</span>/9 Módulos aprobados</span>
    <span><span id="mod_cred">0</span> Créditos en módulos</span>
  </div>
  <div class="container" id="curricula"></div>
  <div class="modules-section">
    <div class="modules-title">MÓDULOS</div>
    <div class="modules-container">
      <div class="module-box" data-mod="ing">
        <div class="module-title" data-mod="ing">Inglés</div>
        <div class="module-list" id="mod-ingles"></div>
      </div>
      <div class="module-box" data-mod="comp">
        <div class="module-title" data-mod="comp">Computación</div>
        <div class="module-list" id="mod-comp"></div>
      </div>
    </div>
  </div>
<script>
const UNIDADES = [
  {
    nombre: "Unidad Preuniversitaria",
    color: "preu",
    semestres: [
      {
        nombre: "PRE",
        code: "pre",
        color: "pre",
        materias: [
          { id: "epistem", nombre: "Epistemología del Turismo", icono: "🧠", creditos: 0, requisitos: [] },
          { id: "introcom", nombre: "Introducción a la Comunicación Académica", icono: "✍️", creditos: 0, requisitos: [] },
          { id: "pcomputo", nombre: "Pensamiento Computacional", icono: "💻", creditos: 0, requisitos: [] }
        ]
      }
    ]
  },
  {
    nombre: "Unidad Básica",
    color: "basica",
    semestres: [
      {
        nombre: "1er Semestre",
        code: "1",
        color: "1",
        materias: [
          { id: "matfina", nombre: "Matemática Financiera", icono:"💰", creditos:1.6666, requisitos: ["pcomputo"] },
          { id: "tecapli", nombre: "Tecnología Aplicada", icono: "🛠️", creditos: 3.33, requisitos: ["pcomputo"] },
          { id: "teotur", nombre: "Teoría Del Turismo", icono: "📚", creditos:3.33, requisitos: ["epistem"] },
          { id: "admin", nombre: "Administración", icono: "📋", creditos:3.33, requisitos: ["introcom"] },
          { id: "metod", nombre: "Metodología De La Investigación Científica", icono: "🔬", creditos:1.67, requisitos: ["introcom"] },
          { id: "tectur", nombre: "Técnicas De Operación Turística", icono: "🧳", creditos:3.33, requisitos: ["epistem"] }
        ]
      },
      {
        nombre: "2do Semestre",
        code: "2",
        color: "2",
        materias: [
          { id: "cosmos", nombre: "Cosmos Histórico", icono: "🏺", creditos:3.33, requisitos: ["teotur"] },
          { id: "bioent", nombre: "Bioentorno Turístico", icono:"🌱", creditos:3.33, requisitos: ["teotur"] },
          { id: "tecguiar", nombre: "Técnicas De Guiar", icono:"🎤", creditos:3.33, requisitos: ["tectur"] },
          { id: "hosp", nombre: "Hospitalidad", icono:"🤝", creditos:3.33, requisitos: ["admin"] },
          { id: "estad", nombre: "Estadística Descriptiva Administrativa", icono:"📊", creditos:1.6666, requisitos:["matfina","tecapli"] },
          { id: "comoral", nombre: "Comunicación Oral Y Escrita", icono:"🗣️", creditos:1.67, requisitos:["metod"] }
        ]
      },
      {
        nombre: "3er Semestre",
        code: "3",
        color: "3",
        materias: [
          { id: "comytur", nombre: "Comunidad Y Turismo", icono:"🏘️", creditos:1.6666, requisitos:["hosp"] },
          { id: "gastropat", nombre: "Gastronomía Ancestral Y Patrimonio", icono:"🍲", creditos:3.33, requisitos:["hosp"] },
          { id: "gestareas", nombre: "Gestión Operativa De Áreas Protegidas", icono:"🏞️", creditos:3.33, requisitos:["tecguiar"] },
          { id: "maniplas", nombre: "Manifestaciones Plásticas Turísticas", icono:"🎨", creditos:3.33, requisitos:["cosmos","comoral"] },
          { id: "prosinter", nombre: "Prospección Intercultural Ecuatoriana", icono:"🌎", creditos:1.6666, requisitos:["cosmos"] },
          { id: "contgen", nombre: "Contabilidad General", icono:"📒", creditos:3.33, requisitos:["estad"] }
        ]
      }
    ]
  },
  {
    nombre: "Unidad Profesional",
    color: "prof",
    semestres: [
      {
        nombre: "4to Semestre",
        code: "4",
        color: "4",
        materias: [
          { id: "finan", nombre: "Finanzas De Corto Plazo", icono:"📈", creditos:3.33, requisitos:["contgen"] },
          { id: "gestionterr", nombre: "Gestión Territorial En Turismo", icono:"🏛️", creditos:3.33, requisitos:["gestareas","maniplas"] },
          { id: "gthc", nombre: "Gestión Del Talento Humano Por Competencias", icono: "👥", creditos:2.5, requisitos:["contgen"] },
          { id: "folklore", nombre: "Folklore", icono:"🎭", creditos:1.6666, requisitos:["maniplas","prosinter"] },
          { id: "codif", nombre: "Codificación Turística", icono:"🧩", creditos:3.33, requisitos:["gestareas"] },
          { id: "campismo", nombre: "Campismo Y Recreación Turística", icono: "⛺", creditos:1.6666, requisitos:["gastropat","comytur"] }
        ]
      },
      {
        nombre: "5to Semestre",
        code: "5",
        color: "5",
        materias: [
          { id: "arqueo", nombre: "Arqueología", icono:"🗿", creditos:1.6666, requisitos:["folklore"] },
          { id: "micro", nombre: "Microeconomía", icono:"🏦", creditos:3.33, requisitos:["finan"] },
          { id: "iconotur", nombre: "Iconografía Turística", icono:"🖼️", creditos:1.6666, requisitos:["campismo"] },
          { id: "opetours", nombre: "Operación De Tours", icono:"🚍", creditos:3.33, requisitos:["codif","gestionterr"] },
          { id: "fomentoreg", nombre: "Fomento Y Regulaciones A La Actividad Turística", icono:"⚖️", creditos:3.33, requisitos:["gthc"] },
          { id: "desarollotur", nombre: "Desarrollo Del Turismo Sostenible", icono:"♻️", creditos:5, requisitos:["matfina","tecapli","teotur","admin","metod","tectur","cosmos","bioent","tecguiar","hosp","estad","comoral","comytur","gastropat","gestareas","maniplas","prosinter","contgen","finan","gestionterr","gthc","folklore","codif","campismo"] }
        ]
      },
      {
        nombre: "6to Semestre",
        code: "6",
        color: "6",
        materias: [
          { id: "plantur", nombre: "Planificación Turística", icono:"🗓️", creditos:5, requisitos:["matfina","tecapli","teotur","admin","metod","tectur","cosmos","bioent","tecguiar","hosp","estad","comoral","comytur","gastropat","gestareas","maniplas","prosinter","contgen","finan","gestionterr","gthc","folklore","codif","campismo","arqueo","micro","iconotur","opetours","fomentoreg","desarollotur"] },
          { id: "gesinnov", nombre: "Gestión De La Innovación Y Emprendimiento", icono:"🚀", creditos:3.33, requisitos:["fomentoreg"] },
          { id: "animtur", nombre: "Animación Turística", icono:"🎬", creditos:3.33, requisitos:["iconotur"] },
          { id: "rice", nombre: "Rice - Organización De Eventos", icono:"📅", creditos:1.6666, requisitos:["desarollotur"] },
          { id: "sistreg", nombre: "Sistemas De Registros Turísticos / Sabre Y Amadeus", icono:"🧾", creditos:1.6666, requisitos:["opetours"] },
          { id: "macro", nombre: "Macroeconomía", icono:"🌐", creditos:3.33, requisitos:["micro"] }
        ]
      },
      {
        nombre: "7mo Semestre",
        code: "7",
        color: "7",
        materias: [
          { id: "patrimonio", nombre: "Patrimonio", icono:"🏛️", creditos:5, requisitos:["plantur","gesinnov","animtur","rice","sistreg","macro"] },
          { id: "gcalidad", nombre: "Gestión De Calidad Y La Productividad", icono:"✅", creditos:3.33, requisitos:["gesinnov"] },
          { id: "alibe", nombre: "Operación De Alimentos Y Bebidas", icono:"🍽️", creditos:1.6666, requisitos:["animtur"] },
          { id: "hoteleria", nombre: "Operación Hotelera", icono:"🏨", creditos:3.33, requisitos:["sistreg"] },
          { id: "sociotur", nombre: "Sociología Del Turismo", icono:"👨‍👩‍👧‍👦", creditos:3.33, requisitos:["animtur"] },
          { id: "tendtur", nombre: "Tendencias Turísticas", icono:"📈", creditos:1.6666, requisitos:["macro"] }
        ]
      }
    ]
  },
  {
    nombre: "Unidad de Titulación",
    color: "titu",
    semestres: [
      {
        nombre: "8vo Semestre",
        code: "8",
        color: "8",
        materias: [
          { id: "fyep", nombre: "Formulación Y Evaluación De Proyectos", icono:"📐", creditos:3.33, requisitos:["gcalidad"] },
          { id: "integ", nombre: "Integración Regional Turística", icono:"🤝", creditos:5, requisitos:["patrimonio","gcalidad","alibe","hoteleria","sociotur","tendtur"] },
          { id: "estrac", nombre: "Estrategias Comerciales Turísticas", icono:"🎯", creditos:3.33, requisitos:["tendtur"] },
          { id: "redtit", nombre: "Redacción Del Trabajo De Titulación", icono:"📖", creditos:1.6666, requisitos:["patrimonio","gcalidad","alibe","hoteleria","sociotur","tendtur"] },
          { id: "arteycultu", nombre: "Apreciación Del Arte Y La Cultura", icono:"🖌️", creditos:1.6666, requisitos:["patrimonio"] },
          { id: "gobernanza", nombre: "Turismo Y Gobernanza", icono:"🏛️", creditos:3.33, requisitos:["alibe","sociotur"] }
        ]
      },
      {
        nombre: "9no Semestre",
        code: "9",
        color: "9",
        materias: [
          { id: "gesdest", nombre: "Gestión Integral De Destinos Turísticos", icono:"🌟", creditos:5, requisitos:["fyep","integ","estrac","redtit","arteycultu","gobernanza"] },
          { id: "negociatur", nombre: "Técnicas De Negociación Y Comunicación Para El Turismo", icono:"🤝🗣️", creditos:3.3333, requisitos:["estrac"] },
          { id: "realnac", nombre: "Realidad Nacional Y Geopolítica", icono:"🌏", creditos:1.67, requisitos:["gobernanza"] },
          { id: "trabtit", nombre: "Trabajo De Titulación", icono:"🎓", creditos:3.33, requisitos:["redtit"] },
          { id: "contrapub", nombre: "Contratación Pública", icono:"📝", creditos:3.33, requisitos:["fyep"] },
          { id: "liderazgo", nombre: "Liderazgo", icono:"👑", creditos:1.6666, requisitos:["arteycultu"] }
        ]
      }
    ]
  }
];

// Módulos
const MODULOS = [
  {
    nombre: "Inglés",
    code: "ing",
    list: [
      {id: "ing_a1m", nombre: "-A1", icono: "🔴🏆", creditos:2.08, requisitos: []},
      {id: "ing_a1", nombre: "A1", icono: "🟠🏆", creditos:2.08, requisitos:["ing_a1m"]},
      {id: "ing_a2", nombre: "A2", icono: "🟡🏆", creditos:2.08, requisitos:["ing_a1"]},
      {id: "ing_b1", nombre: "B1", icono: "🟢🏆", creditos:2.08, requisitos:["ing_a2"]},
      {id: "ing_b2", nombre: "B2", icono: "🔵🏆", creditos:2.08, requisitos:["ing_b1"]},
      {id: "ing_c1", nombre: "C1", icono: "🟣🏆", creditos:2.08, requisitos:["ing_b2"]},
      {id: "ing_c2", nombre: "C2", icono: "🟤🏆", creditos:2.08, requisitos:["ing_c1"]}
    ]
  },
  {
    nombre: "Computación",
    code: "comp",
    list: [
      {id: "comp_win", nombre: "Windows - Word - Internet", icono: "🪟📄🌐", creditos:8, requisitos:[]},
      {id: "comp_excel", nombre: "Excel – Power Point", icono: "📊📽️", creditos:8, requisitos:["comp_win"]}
    ]
  }
];

// -- Renderizado de malla curricular --
function renderCurricula(){
  const container = document.getElementById('curricula');
  container.innerHTML = '';
  for(const unidad of UNIDADES){
    const unitDiv = document.createElement('div');
    unitDiv.className = 'unit';
    // Título con color por unidad
    const tit = document.createElement('div');
    tit.className = 'unit-title';
    if(unidad.color) tit.dataset.color = unidad.color;
    tit.textContent = unidad.nombre;
    unitDiv.appendChild(tit);

    // Secciones de semestres
    const semRow = document.createElement('div');
    semRow.className = 'unit-sems';
    for(const sem of unidad.semestres){
      const semCol = document.createElement('div');
      semCol.className = 'sem-col';
      semCol.dataset.sem = sem.code;

      // Título
      const title = document.createElement('div');
      title.className = 'sem-title';
      title.textContent = sem.nombre;
      title.dataset.sem = sem.code;
      semCol.appendChild(title);

      // Materias
      const list = document.createElement('div');
      list.className = 'subjects';
      for(const mat of sem.materias){
        const subj = document.createElement('div');
        subj.className = 'subject-card';
        subj.setAttribute('tabindex','0');
        subj.dataset.id = mat.id;
        subj.dataset.creditos = mat.creditos;
        subj.setAttribute('data-sem', sem.code);
        if(mat.requisitos.length>0) subj.dataset.req = mat.requisitos.join("|");

        subj.innerHTML = `<span class='subject-icon'>${mat.icono}</span>
                          <span class='subject-label'>${mat.nombre}</span>
                          <span class='subject-credit'>${mat.creditos?mat.creditos:"0"}</span>
                          <span class='subject-check'>✔️</span>
                          `;
        // Event: onClick aprobar
        subj.addEventListener('click', function(e){
          aprobarMateria(mat.id);
        });
        // Keyboard acc
        subj.addEventListener('keydown', function(e){
          if(e.key === "Enter" || e.key ===" "){
            e.preventDefault();
            aprobarMateria(mat.id);
          }
        });
        list.appendChild(subj);
      }
      semCol.appendChild(list);
      semRow.appendChild(semCol);
    }
    unitDiv.appendChild(semRow);
    container.appendChild(unitDiv);
  }
}
// -- Renderizado Módulos
function renderModulos(){
  for(const module of MODULOS){
    const listdiv = document.getElementById("mod-" + module.code);
    listdiv.innerHTML = '';
    for(const mod of module.list){
      const modcard = document.createElement('div');
      modcard.className = 'module-card';
      modcard.setAttribute('tabindex','0');
      modcard.dataset.id = mod.id;
      modcard.dataset.creditos = mod.creditos;
      if(mod.requisitos.length>0) modcard.dataset.req = mod.requisitos.join("|");
      modcard.innerHTML = `<span class="mod-icon">${mod.icono}</span>
                           <span class="mod-label">${mod.nombre}</span>
                           <span class="mod-credit">${mod.creditos}</span>
                           <span class='mod-check'>✔️</span>
                           `;
      modcard.addEventListener('click', function(e){
        aprobarModulo(mod.id);
      });
      modcard.addEventListener('keydown', function(e){
        if(e.key === "Enter" || e.key ===" "){
          e.preventDefault();
          aprobarModulo(mod.id);
        }
      });
      listdiv.appendChild(modcard);
    }
  }
}

function getAprobadas(){
  let arr = JSON.parse(localStorage.getItem('malla_turismo_aprob'))||[];
  return new Set(arr);
}
function getModAprobadas(){
  let arr = JSON.parse(localStorage.getItem('malla_turismo_mod_aprob'))||[];
  return new Set(arr);
}
function aprobarMateria(id){
  let aprob = getAprobadas();
  if(aprob.has(id)){
    aprob.delete(id);
  }else{
    // Sólo si está desbloqueada
    if(!document.querySelector(`[data-id="${id}"]`).classList.contains('locked')){
      aprob.add(id);
    }
  }
  localStorage.setItem('malla_turismo_aprob',JSON.stringify(Array.from(aprob)));
  actualizarEstado();
}
function aprobarModulo(id){
  let aprob = getModAprobadas();
  if(aprob.has(id)){
    aprob.delete(id);
  }else{
    if(!document.querySelector(`[data-id="${id}"]`).classList.contains('locked')){
      aprob.add(id);
    }
  }
  localStorage.setItem('malla_turismo_mod_aprob',JSON.stringify(Array.from(aprob)));
  actualizarEstado();
}

// Estado para tooltips y bloqueos
function actualizarEstado(){
  let aprob = getAprobadas();
  let aprobM = getModAprobadas();

  // MATERIAS
  let idsAprob = new Set(aprob);
  document.querySelectorAll('.subject-card').forEach(card=>{
    let id = card.dataset.id;
    let mat = buscarMateriaPorID(id);

    // ¿Bloqueada?
    let locked = false, reason = [];
    if(mat.requisitos.length){
      for(let req of mat.requisitos){
        if(!idsAprob.has(req)){
          locked = true;
          let faltan = buscarMateriaPorID(req);
          reason.push(faltan?faltan.nombre:req);
        }
      }
    }
    if(locked){
      card.classList.add("locked");
      card.classList.remove("approved");
      card.setAttribute('data-tooltip','Faltan: ' + reason.join(", "));
    }else{
      card.classList.remove("locked");
      card.setAttribute('data-tooltip','');
      if(idsAprob.has(id)){
        card.classList.add("approved");
      }else{
        card.classList.remove("approved");
      }
    }
  });

  // MODULOS
  let idsAprobM = new Set(aprobM);
  document.querySelectorAll('.module-card').forEach(card=>{
    let id = card.dataset.id;
    let mod = buscarModuloPorID(id);

    let locked = false, reason=[];
    if(mod.requisitos.length){
      for(let req of mod.requisitos){
        if(!idsAprobM.has(req)){
          locked = true;
          let faltan = buscarModuloPorID(req);
          reason.push(faltan?faltan.nombre:req);
        }
      }
    }
    if(locked){
      card.classList.add("locked");
      card.classList.remove("approved");
      card.setAttribute('data-tooltip','Falta: ' + reason.join(", "));
    }else{
      card.classList.remove("locked");
      card.setAttribute('data-tooltip','');
      if(idsAprobM.has(id)){
        card.classList.add("approved");
      }else{
        card.classList.remove("approved");
      }
    }
  });
  // Estadísticas
  let total = 0, creditos = 0;
  document.querySelectorAll('.subject-card').forEach(card=>{
    if(card.classList.contains('approved')){
      total += 1;
      creditos += Number(card.dataset.creditos||0);
    }
  });
  document.getElementById('aprobadas').textContent = total;
  document.getElementById('creditos').textContent = creditos.toFixed(2);

  let tmod = 0, credmod = 0;
  document.querySelectorAll('.module-card').forEach(card=>{
    if(card.classList.contains('approved')){
      tmod += 1;
      credmod += Number(card.dataset.creditos || 0);
    }
  });
  document.getElementById('mod_ap').textContent = tmod;
  document.getElementById('mod_cred').textContent = credmod.toFixed(2);
}

function buscarMateriaPorID(id){
  for(const unidad of UNIDADES){
    for(const sem of unidad.semestres){
      for(const mat of sem.materias){
        if(mat.id === id) return mat;
      }
    }
  }
  return null;
}
function buscarModuloPorID(id){
  for(const m of MODULOS){
    for(const card of m.list){
      if(card.id === id) return card;
    }
  }
  return null;
}
// Reset
function resetearProgreso(){
  if(confirm("¿Resetear el progreso?")) {
    localStorage.removeItem('malla_turismo_aprob');
    localStorage.removeItem('malla_turismo_mod_aprob');
    location.reload();
  }
}
function agregarResetBtn(){
  let stats = document.getElementById('stats');
  let reset = document.createElement('button');
  reset.textContent="Resetear Progreso";
  reset.style = "margin-left:2em;background:#1AB4E8;color:#fff;border:none;border-radius:6px;padding:.33em 1.2em;font-size:.98em;cursor:pointer;";
  reset.onclick=resetearProgreso;
  stats.appendChild(reset);
}
// INIT
renderCurricula();
renderModulos();
actualizarEstado();
agregarResetBtn();

</script>
</body>
</html>
