<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Licenciatura en Turismo - Malla Curricular</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Fuentes agradables -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-neutral1: #F7F7F7;
      --bg-neutral2: #ECECEC;
      --bg-neutral3: #E0E0E0;
      --bg-neutral4: #D4D4D4;
      --txt-dark: #313131;

      /* Paletas UNIDADES */
      --pre-bg: #E1F3FB;
      --pre-color: #008BA3;
      --bas-bg: #E6F9E8;
      --bas-color: #1B5E20;
      --prof-bg: #FFFBEB;
      --prof-color: #FFB300;
      --tit-bg: #FFEAEA;
      --tit-color: #E53935;

      /* Paletas SEMESTRES */
      --pre-1: #E0F7FA; --pre-2: #B2EBF2; --pre-3: #80DEEA; --pre-4: #4DD0E1; --pre-5: #26C6DA; --pre-6: #00BCD4;
      --sem-1-1: #E8F5E9; --sem-1-2: #C8E6C9; --sem-1-3: #A5D6A7; --sem-1-4: #81C784; --sem-1-5: #66BB6A; --sem-1-6: #43A047;
      --sem-2-1: #FFF3E0; --sem-2-2: #FFE0B2; --sem-2-3: #FFCC80; --sem-2-4: #FFB74D; --sem-2-5: #FFA726; --sem-2-6: #FF9800;
      --sem-3-1: #F3E5F5; --sem-3-2: #E1BEE7; --sem-3-3: #CE93D8; --sem-3-4: #BA68C8; --sem-3-5: #AB47BC; --sem-3-6: #9C27B0;
      --sem-4-1: #FCE4EC; --sem-4-2: #F8BBD0; --sem-4-3: #F48FB1; --sem-4-4: #F06292; --sem-4-5: #EC407A; --sem-4-6: #E91E63;
      --sem-5-1: #FFFDE7; --sem-5-2: #FFF9C4; --sem-5-3: #FFF59D; --sem-5-4: #FFF176; --sem-5-5: #FFEE58; --sem-5-6: #FFEB3B;
      --sem-6-1: #FFEBEE; --sem-6-2: #FFCDD2; --sem-6-3: #EF9A9A; --sem-6-4: #E57373; --sem-6-5: #EF5350; --sem-6-6: #F44336;
      --sem-7-1: #E8F5E9; --sem-7-2: #C8E6C9; --sem-7-3: #A5D6A7; --sem-7-4: #81C784; --sem-7-5: #66BB6A; --sem-7-6: #388E3C;
      --sem-8-1: #E3F2FD; --sem-8-2: #BBDEFB; --sem-8-3: #90CAF9; --sem-8-4: #64B5F6; --sem-8-5: #42A5F5; --sem-8-6: #1976D2;
      --sem-9-1: #FAFAFA; --sem-9-2: #F5F5F5; --sem-9-3: #EEEEEE; --sem-9-4: #E0E0E0; --sem-9-5: #BDBDBD; --sem-9-6: #757575;

      --mod-bg1: #F7F7F7;
      --mod-bg2: #EFEFEF;
      --mod-bg3: #E5E5E5;

      /* Modulo INGLÉS */
      --eng-1: #E0F7FA; --eng-2: #B2EBF2; --eng-3: #80DEEA; --eng-4: #4DD0E1; --eng-5: #26C6DA; --eng-6: #00BCD4; --eng-7: #0097A7; --eng-title: #006064;
      /* Módulo COMPUTACIÓN */
      --comp-1: #F3E5F5; --comp-2: #E1BEE7; --comp-3: #CE93D8; --comp-title: #6A1B9A;
    }

    html, body {
      background: var(--bg-neutral1);
      font-family: 'Nunito', Arial, sans-serif;
      color: var(--txt-dark);
      margin: 0;
      min-height: 100vh;
    }

    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2em 1em 1em 1em;
      background: linear-gradient(135deg, var(--pre-bg) 15%, var(--tit-bg) 100%);
    }

    header h1 {
      font-family: 'Montserrat', Arial, sans-serif;
      font-size: 2.2em;
      margin-bottom: 0.1em;
      font-weight: bold;
      color: var(--pre-color);
      letter-spacing: 1px;
      text-shadow: 0 1px 8px #fff, 0 1px 2px #bbb7;
    }

    header p {
      color: var(--txt-dark);
      font-size: 1.15em;
      margin-top: 0;
      margin-bottom: 0.5em;
    }

    #stats {
      margin: 1em 0 0.5em 0;
      display: flex;
      gap: 2em;
      justify-content: center;
      font-size: 1.1em;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    #stats span {
      display: flex;
      align-items: center;
      background: var(--bg-neutral3);
      border-radius: 1em;
      padding: 0.4em 1.3em;
      margin-right: .5em;
      font-weight: 700;
      letter-spacing: .5px;
      box-shadow: 0 2px 8px #0001;
    }

    h2.unit-title {
      font-family: 'Montserrat', Arial, sans-serif;
      font-size: 1.3em;
      font-weight: 700;
      margin-top: 2em;
      margin-bottom: 0.8em;
      opacity: 0.89;
      letter-spacing: .4px;
      text-align: center;
    }

    .units {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .unit-section {
      width: 96vw;
      max-width: 1600px;
      min-width: 340px;
      margin-bottom: 1.3em;
      box-sizing: border-box;
      padding: 1.25em .8em;
      border-radius: 19px;
      box-shadow: 0 4px 19px #0001;
      margin-top: 12px;
      background: var(--bg-neutral2);
    }

    /* DISTRIBUCIÓN HORIZONTAL DE SEMESTRES O BLOQUES */
    .semesters,
    .modules-list {
      display: flex;
      flex-direction: row;
      gap: 1.3em;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
      margin-bottom: 1.1em;
    }

    /* COLUMNA DE CADA SEMESTRE O MÓDULO */
    .semester-col,
    .module-col {
      flex: 1 1 190px;
      min-width: 190px;
      max-width: 220px;
      background: var(--bg-neutral1);
      border-radius: 14px;
      box-sizing: border-box;
      box-shadow: 0 2px 8px #0001;
      padding: 1.17em .7em .9em .7em;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Título semestre/módulo */
    .semester-title,
    .module-title {
      font-size: 1.05em;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: bold;
      margin: 0 0 0.3em 0;
      text-align: center;
      letter-spacing: 1px;
    }

    /* Paletas de color por semestre */
    .semester-title[data-sem="Pre"] { color: var(--pre-color);}
    .semester-title[data-sem="1"] { color: var(--sem-1-6);}
    .semester-title[data-sem="2"] { color: #EF6C00;}
    .semester-title[data-sem="3"] { color: #6A1B9A;}
    .semester-title[data-sem="4"] { color: #AD1457;}
    .semester-title[data-sem="5"] { color: #FBC02D;}
    .semester-title[data-sem="6"] { color: #C62828;}
    .semester-title[data-sem="7"] { color: #1B5E20;}
    .semester-title[data-sem="8"] { color: #0D47A1;}
    .semester-title[data-sem="9"] { color: #424242;}

    /* Por unidad */
    .unit-pre { background: var(--pre-bg);}
    .unit-basic { background: var(--bas-bg);}
    .unit-prof { background: var(--prof-bg);}
    .unit-tit { background: var(--tit-bg);}

    /* TARJETAS */
    .course {
      width: 97%;
      position: relative;
      background: var(--bg-neutral3);
      border-radius: 9px;
      margin: 0.46em 0;
      padding: 0.7em 0.75em 0.55em 0.75em;
      font-size: 0.98em;
      display: flex;
      align-items: center;
      box-shadow: 0 1px 7px #00000009, 0 1px 1px #0000000c;
      transition: box-shadow 0.16s, transform 0.16s;
      user-select: none;
      cursor: pointer;
      border: 2px solid transparent;
      color: #222;
    }
    .course.approved {
      background: #d4e8d4;
      border-color: #60c47a;
      box-shadow: 0 0 6px #4dd78b55;
      text-decoration: line-through;
      opacity: 0.74;
    }
    .course.locked {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f4dddd !important;
      color: #902d2d;
      border-color: #e17474;
      text-decoration: none;
    }
    .course .icon {
      font-size: 1.19em;
      margin-right: 0.72em;
      min-width: 1.5em;
      text-align: center;
    }
    .course .cr {
      margin-left: auto;
      font-weight: 700;
      font-size: 0.92em;
      color: #32714d;
      background: #f3fef8;
      padding: 0.10em 0.9em;
      border-radius: 1em;
      margin-right: 0.4em;
      filter: brightness(0.85);
    }

    /* Tooltips */
    .course .tooltip {
      visibility: hidden;
      background: #363636de;
      color: #fff;
      font-size: 0.92em;
      position: absolute;
      left: 24px;
      top: 61%;
      transform: translateY(-50%);
      white-space: pre-line;
      padding: 0.35em 0.7em;
      border-radius: 7px;
      z-index: 5;
      opacity: 0;
      pointer-events: none;
      transition: all 0.15s;
    }
    .course.locked:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }

    /* Módulos */
    .modules-list {
      margin-top: 0.5em;
      margin-bottom: 0.7em;
    }
    .module-col {
      background: var(--mod-bg1);
      min-width: 160px;
    }
    .module-title[data-mod="ing"] { color: var(--eng-title);}
    .module-title[data-mod="comp"] { color: var(--comp-title);}

    .module-course {
      width: 97%;
      background: var(--mod-bg2);
      border-radius: 10px;
      margin: 0.46em 0;
      padding: 0.7em 0.6em 0.55em 0.6em;
      font-size: 0.99em;
      display: flex;
      align-items: center;
      box-shadow: 0 1px 7px #00000014, 0 1px 1px #00000013;
      border: 2px solid transparent;
      color: #202020;
      transition: filter 0.1s, box-shadow 0.15s;
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    .module-course.approved {
      background: #dde6f5;
      border-color: #4099c1;
      box-shadow: 0 0 6px #00798070;
      text-decoration: line-through;
      opacity: 0.74;
    }
    .module-course.locked {
      background: #f2e6ee !important;
      border-color: #ab47bcaa;
      color: #6a1b9a;
      cursor: not-allowed;
      opacity: 0.5;
      text-decoration: none;
    }

    .module-course .icon { min-width: 1.54em; margin-right: 0.7em;}
    .module-course .cr {
      margin-left: auto;
      font-size: 0.93em;
      font-weight: 700;
      color: #795eb7;
      background: #f8f5fd;
      border-radius: 1em;
      padding: 0.1em 0.85em;
      filter: brightness(0.80);
    }
    .module-course .tooltip {
      visibility: hidden;
      position: absolute;
      left: 26px;
      top: 68%;
      transform: translateY(-50%);
      background: #242424ee;
      color: #fff;
      font-size: 0.92em;
      border-radius: 6px;
      padding: 0.30em 0.95em;
      z-index: 9;
      white-space: pre-line;
      opacity: 0;
      pointer-events: none;
      transition: all 0.16s;
    }
    .module-course.locked:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
    /* Responsive */
    @media (max-width: 900px) {
      .semesters, .modules-list {flex-wrap: wrap;}
    }
    @media (max-width: 650px) {
      .semester-col, .module-col {min-width: 97vw; max-width: 99vw;}
      .units {padding-left: 0; padding-right: 0;}
      .unit-section {padding-left: 0; padding-right: 0;}
      .modules-list, .semesters {gap: 0.2em;}
      .course, .module-course { min-width: 95vw; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Licenciatura en Turismo 🎓</h1>
    <p>Malla Curricular Interactiva · 57 asignaturas · 9 módulos · Créditos automáticos</p>
    <div id="stats">
      <span id="mat-ap">Materias aprobadas: <b>0</b>/57</span>
      <span id="mod-ap">Módulos aprobados: <b>0</b>/9</span>
      <span id="credit-ap">Créditos obtenidos: <b>0</b></span>
    </div>
  </header>
  <main>
    <div class="units">
      <!-- Estructura generada por JavaScript -->
    </div>
  </main>
  <script>
    // ----------------- DATOS DE LA MALLA / ESTRUCTURA --------------
    // Definición de materias con dependencias y créditos agrupadas por Unidades > Semestres/Bloques
    const mallaData = [
      {
        unit: "Unidad Preuniversitaria",
        colorClass: "unit-pre",
        semestres: [
          {
            label: "PRE",
            color: ["var(--pre-1)", "var(--pre-2)", "var(--pre-3)", "var(--pre-4)", "var(--pre-5)", "var(--pre-6)"],
            cursos: [
              { id: "epist", n: "Epistemología del Turismo", icon: "🧠", credit: 0, dep: [] },
              { id: "com-acad", n: "Introducción a la Comunicación Académica", icon: "✍️", credit: 0, dep: [] },
              { id: "pc", n: "Pensamiento Computacional", icon: "💻", credit: 0, dep: [] }
            ]
          }
        ]
      },
      {
        unit: "Unidad Básica",
        colorClass: "unit-basic",
        semestres: [
          {
            label: "1",
            color: ["var(--sem-1-1)", "var(--sem-1-2)", "var(--sem-1-3)", "var(--sem-1-4)", "var(--sem-1-5)", "var(--sem-1-6)"],
            cursos: [
              { id: "mf", n: "Matemática Financiera", icon: "💰", credit: 1.6666, dep: ["pc"] },
              { id: "tecap", n: "Tecnología Aplicada", icon: "🛠️", credit: 3.33, dep: ["pc"] },
              { id: "teotur", n: "Teoría del Turismo", icon: "📚", credit: 3.33, dep: ["epist"] },
              { id: "admin", n: "Administración", icon: "📋", credit: 3.33, dep: ["com-acad"] },
              { id: "metodo", n: "Metodología de la Investigación Científica", icon: "🔬", credit: 1.67, dep: ["com-acad"] },
              { id: "tecop", n: "Técnicas de Operación Turística", icon: "🧳", credit: 3.33, dep: ["epist"] }
            ]
          },
          {
            label: "2",
            color: ["var(--sem-2-1)", "var(--sem-2-2)", "var(--sem-2-3)", "var(--sem-2-4)", "var(--sem-2-5)", "var(--sem-2-6)"],
            cursos: [
              { id: "cosmos", n: "Cosmos Histórico", icon: "🏺", credit: 3.33, dep: ["teotur"] },
              { id: "bioent", n: "Bioentorno Turístico", icon: "🌱", credit: 3.33, dep: ["teotur"] },
              { id: "guiar", n: "Técnicas de Guiar", icon: "🗺️", credit: 3.33, dep: ["tecop"] },
              { id: "hot", n: "Hospitalidad", icon: "🤝", credit: 3.33, dep: ["admin"] },
              { id: "estad", n: "Estadística Descriptiva Administrativa", icon: "📊", credit: 1.6666, dep: ["mf", "tecap"] },
              { id: "comoscr", n: "Comunicación Oral y Escrita", icon: "🗣️", credit: 1.67, dep: ["metodo"] }
            ]
          },
          {
            label: "3",
            color: ["var(--sem-3-1)", "var(--sem-3-2)", "var(--sem-3-3)", "var(--sem-3-4)", "var(--sem-3-5)", "var(--sem-3-6)"],
            cursos: [
              { id: "comytur", n: "Comunidad y Turismo", icon: "🏘️", credit: 1.6666, dep: ["hot"] },
              { id: "gastpat", n: "Gastronomía Ancestral y Patrimonio", icon: "🍲", credit: 3.33, dep: ["hot"] },
              { id: "gestap", n: "Gestión Operativa de Áreas Protegidas", icon: "🏞️", credit: 3.33, dep: ["guiar"] },
              { id: "mplast", n: "Manifestaciones Plásticas Turísticas", icon: "🎨", credit: 3.33, dep: ["cosmos", "comoscr"] },
              { id: "prosint", n: "Prospección Intercultural Ecuatoriana", icon: "🌎", credit: 1.6666, dep: ["cosmos"] },
              { id: "contag", n: "Contabilidad General", icon: "📒", credit: 3.33, dep: ["estad"] }
            ]
          }
        ]
      },
      {
        unit: "Unidad Profesional",
        colorClass: "unit-prof",
        semestres: [
          {
            label: "4",
            color: ["var(--sem-4-1)", "var(--sem-4-2)", "var(--sem-4-3)", "var(--sem-4-4)", "var(--sem-4-5)", "var(--sem-4-6)"],
            cursos: [
              { id: "finz", n: "Finanzas de Corto Plazo", icon: "📈", credit: 3.33, dep: ["contag"] },
              { id: "gestterr", n: "Gestión Territorial en Turismo", icon: "🌍", credit: 3.33, dep: ["gestap", "mplast"] },
              { id: "talhum", n: "Gestión del Talento Humano por Competencias", icon: "👥", credit: 2.5, dep: ["contag"] },
              { id: "folk", n: "Folklore", icon: "🎭", credit: 1.6666, dep: ["mplast", "prosint"] },
              { id: "codif", n: "Codificación Turística", icon: "🧩", credit: 3.33, dep: ["gestap"] },
              { id: "camp", n: "Campismo y Recreación Turística", icon: "⛺", credit: 1.6666, dep: ["gastpat", "comytur"] }
            ]
          },
          {
            label: "5",
            color: ["var(--sem-5-1)", "var(--sem-5-2)", "var(--sem-5-3)", "var(--sem-5-4)", "var(--sem-5-5)", "var(--sem-5-6)"],
            cursos: [
              { id: "arqueo", n: "Arqueología", icon: "🗿", credit: 1.6666, dep: ["folk"] },
              { id: "micro", n: "Microeconomía", icon: "🏦", credit: 3.33, dep: ["finz"] },
              { id: "icono", n: "Iconografía Turística", icon: "🖼️", credit: 1.6666, dep: ["camp"] },
              { id: "optours", n: "Operación de Tours", icon: "🚍", credit: 3.33, dep: ["codif", "gestterr"] },
              { id: "fomreg", n: "Fomento y Regulaciones a la Actividad Turística", icon: "⚖️", credit: 3.33, dep: ["talhum"] },
              { id: "devtursos", n: "Desarrollo del Turismo Sostenible", icon: "♻️", credit: 5, dep: [
                "mf","tecap","teotur","admin","metodo","tecop","cosmos","bioent","guiar","hot","estad",
                "comoscr","comytur","gastpat","gestap","mplast","prosint","contag",
                "finz","gestterr","talhum", "folk","codif","camp"
              ]}
            ]
          },
          {
            label: "6",
            color: ["var(--sem-6-1)", "var(--sem-6-2)", "var(--sem-6-3)", "var(--sem-6-4)", "var(--sem-6-5)", "var(--sem-6-6)"],
            cursos: [
              { id: "plantur", n: "Planificación Turística", icon: "🗓️", credit: 5, dep: [
                "mf","tecap","teotur","admin","metodo","tecop","cosmos","bioent","guiar","hot","estad",
                "comoscr","comytur","gastpat","gestap","mplast","prosint","contag",
                "finz","gestterr","talhum", "folk","codif","camp","arqueo","micro","icono","optours","fomreg","devtursos"
              ]},
              { id: "innoemp", n: "Gestión de la Innovación y Emprendimiento", icon: "🚀", credit: 3.33, dep: ["fomreg"] },
              { id: "anmtur", n: "Animación Turística", icon: "🎬", credit: 3.33, dep: ["icono"] },
              { id: "rice", n: "Rice – Organización de Eventos", icon: "📅", credit: 1.6666, dep: ["devtursos"] },
              { id: "sabream", n: "Sistemas de Registros Turísticos / Sabre y Amadeus", icon: "🧾", credit: 1.6666, dep: ["optours"] },
              { id: "macro", n: "Macroeconomía", icon: "🌐", credit: 3.33, dep: ["micro"] }
            ]
          },
          {
            label: "7",
            color: ["var(--sem-7-1)", "var(--sem-7-2)", "var(--sem-7-3)", "var(--sem-7-4)", "var(--sem-7-5)", "var(--sem-7-6)"],
            cursos: [
              { id: "patr", n: "Patrimonio", icon: "🏛️", credit: 5, dep: ["plantur","innoemp","anmtur","rice","sabream","macro"] },
              { id: "calid", n: "Gestión de Calidad y la Productividad", icon: "✅", credit: 3.33, dep: ["innoemp"] },
              { id: "opayb", n: "Operación de Alimentos y Bebidas", icon: "🍽️", credit: 1.6666, dep: ["anmtur"] },
              { id: "ophotel", n: "Operación Hotelera", icon: "🏨", credit: 3.33, dep: ["sabream"] },
              { id: "sociotur", n: "Sociología del Turismo", icon: "👨‍👩‍👧‍👦", credit: 3.33, dep: ["anmtur"] },
              { id: "tend", n: "Tendencias Turísticas", icon: "📈", credit: 1.6666, dep: ["macro"] }
            ]
          }
        ]
      },
      {
        unit: "Unidad de Titulación",
        colorClass: "unit-tit",
        semestres: [
          {
            label: "8",
            color: ["var(--sem-8-1)", "var(--sem-8-2)", "var(--sem-8-3)", "var(--sem-8-4)", "var(--sem-8-5)", "var(--sem-8-6)"],
            cursos: [
              { id: "formevproj", n: "Formulación y Evaluación de Proyectos", icon: "📐", credit: 3.33, dep: ["calid"] },
              { id: "integ", n: "Integración Regional Turística", icon: "🤝", credit: 5, dep: ["patr","calid","opayb","ophotel","sociotur","tend"] },
              { id: "estrat", n: "Estrategias Comerciales Turísticas", icon: "🎯", credit: 3.33, dep: ["tend"] },
              { id: "redact", n: "Redacción del Trabajo de Titulación", icon: "📖", credit: 1.6666, dep: ["patr","calid","opayb","ophotel","sociotur","tend"] },
              { id: "aparte", n: "Apreciación del Arte y la Cultura", icon: "🖌️", credit: 1.6666, dep: ["patr"] },
              { id: "gobernanza", n: "Turismo y Gobernanza", icon: "🏛️", credit: 3.33, dep: ["opayb","sociotur"] }
            ]
          },
          {
            label: "9",
            color: ["var(--sem-9-1)", "var(--sem-9-2)", "var(--sem-9-3)", "var(--sem-9-4)", "var(--sem-9-5)", "var(--sem-9-6)"],
            cursos: [
              { id: "gidest", n: "Gestión Integral de Destinos Turísticos", icon: "🌟", credit: 5, dep: ["formevproj","integ","estrat","redact","aparte","gobernanza"] },
              { id: "tecnnec", n: "Técnicas de Negociación y Comunicación para el Turismo", icon: "🤝🗣️", credit: 3.3333, dep: ["estrat"] },
              { id: "realgeo", n: "Realidad Nacional y Geopolítica", icon: "🌏", credit: 1.67, dep: ["gobernanza"] },
              { id: "trabtit", n: "Trabajo de Titulación", icon: "🎓", credit: 3.33, dep: ["redact"] },
              { id: "contrpub", n: "Contratación Pública", icon: "📝", credit: 3.33, dep: ["formevproj"] },
              { id: "lider", n: "Liderazgo", icon: "👑", credit: 1.6666, dep: ["aparte"] }
            ]
          }
        ]
      }
    ];

    // MODULOS
    const modulos = [
      {
        block: "Inglés",
        color: ["var(--eng-1)", "var(--eng-2)", "var(--eng-3)", "var(--eng-4)", "var(--eng-5)", "var(--eng-6)", "var(--eng-7)"],
        colorTitle: "var(--eng-title)",
        blockKey: "ing",
        cursos: [
          { id: "m-ina1", n: "-A1", icon: "🔴🏆", credit: 2.08, dep: [] },
          { id: "m-a1", n: "A1", icon: "🟠🏆", credit: 2.08, dep: ["m-ina1"] },
          { id: "m-a2", n: "A2", icon: "🟡🏆", credit: 2.08, dep: ["m-a1"] },
          { id: "m-b1", n: "B1", icon: "🟢🏆", credit: 2.08, dep: ["m-a2"] },
          { id: "m-b2", n: "B2", icon: "🔵🏆", credit: 2.08, dep: ["m-b1"] },
          { id: "m-c1", n: "C1", icon: "🟣🏆", credit: 2.08, dep: ["m-b2"] },
          { id: "m-c2", n: "C2", icon: "🟤🏆", credit: 2.08, dep: ["m-c1"] }
        ]
      },
      {
        block: "Computación",
        color: ["var(--comp-1)", "var(--comp-2)"],
        colorTitle: "var(--comp-title)",
        blockKey: "comp",
        cursos: [
          { id: "comp-win", n: "Windows - Word - Internet", icon: "🪟📄🌐", credit: 8, dep: [] },
          { id: "comp-excel", n: "Excel – Power Point", icon: "📊📽️", credit: 8, dep: ["comp-win"] }
        ]
      }
    ];

    // ---- ESTADO del usuario: localStorage
    let estado = {materias: {}, modulos: {}};
    function loadEstado() {
      try {
        estado = JSON.parse(localStorage.getItem('malla-turismo')) || {materias:{}, modulos:{}};
      } catch (e) { estado = {materias:{}, modulos:{}}; }
    }
    function saveEstado() {
      localStorage.setItem('malla-turismo', JSON.stringify(estado));
    }

    // --- IDs aprobados actuales
    function cursosAprobados() {
      return Object.entries(estado.materias).filter(arr=>arr[1]).length;
    }
    function modAprobados() {
      return Object.entries(estado.modulos).filter(arr=>arr[1]).length;
    }
    function sumCreditos() {
      let c=0;
      // materias
      mallaData.forEach(unit=>{
        unit.semestres.forEach(sem=>{
          sem.cursos.forEach(cur=>{
            if(estado.materias[cur.id]) c+=Number(cur.credit);
          });
        });
      });
      // modulos
      modulos.forEach(md=>{
        md.cursos.forEach(mod=>{
          if(estado.modulos[mod.id]) c+=Number(mod.credit);
        });
      });
      return c;
    }

    // Validar bloqueado o tooltip dependencias NO aprobadas
    function isLocked(course, allAprobados) {
      if(!course.dep || !course.dep.length) return false;
      // todas dependencias deben estar verdaderas
      let faltan = course.dep.filter(d=>!allAprobados[d]);
      return faltan.length>0 ? faltan : false;
    }
    function nombreById(id) {
      // buscar en mallaData o modulos
      for(const unit of mallaData)
        for(const sem of unit.semestres)
          for(const cur of sem.cursos)
            if(cur.id===id) return cur.n;
      for(const md of modulos)
        for(const m of md.cursos)
          if(m.id===id) return m.n;
      return id;
    }

    // -------- GENERAR HTML ---------
    function generarMalla() {
      loadEstado();
      const unitsOut = [];
      let allAprobados = Object.assign({}, estado.materias, estado.modulos);

      // UNIDADES PRINCIPALES
      for(const unit of mallaData) {
        const section = document.createElement('section');
        section.className = "unit-section "+unit.colorClass;
        const h2 = document.createElement('h2');
        h2.className = "unit-title";
        h2.innerText = unit.unit;
        section.appendChild(h2);
        // por semestres/columna
        const row = document.createElement('div');
        row.className = "semesters";
        for(let i=0;i<unit.semestres.length;i++){
          const sem = unit.semestres[i];
          const scol = document.createElement('div');
          scol.className = "semester-col";
          // Título
          const t = document.createElement('div');
          t.className = "semester-title";
          t.setAttribute('data-sem', sem.label);
          t.innerText = (["PRE","1","2","3","4","5","6","7","8","9"].includes(sem.label)?sem.label+"° Semestre":sem.label);
          scol.appendChild(t);
          // materias de semestre
          for(let j=0;j<sem.cursos.length;j++){
            const cur = sem.cursos[j];
            const div = document.createElement('div');
            div.className = "course";
            // ¿Aprobada? ¿Bloqueada?
            let bloqueada = false, tooltip = '';
            const faltan = isLocked(cur, allAprobados);
            if(Array.isArray(faltan) && faltan.length>0) {
              bloqueada = true;
              div.classList.add("locked");
              tooltip = 'Falta(n):\n'+faltan.map(fid=>'· '+nombreById(fid)).join('\n');
            }
            if(estado.materias[cur.id]) div.classList.add("approved");
            // Icono, nombre, créditos
            div.innerHTML = `<span class="icon">${cur.icon||""}</span> ${cur.n} <span class="cr" title="Créditos">${Number(cur.credit).toFixed(2)}</span>`;
            // Tooltip
            if(bloqueada)
              div.innerHTML += `<span class="tooltip">${tooltip}</span>`;
            // Interacción
            div.addEventListener('click',e=>{
              if (bloqueada) return;
              estado.materias[cur.id]= !estado.materias[cur.id];
              saveEstado(); renderMalla();
            });
            scol.appendChild(div);
          }
          row.appendChild(scol);
        }
        section.appendChild(row);
        unitsOut.push(section);
        // una vez hecho el dom, actualizar el array allAprobados temporal a la vista
        // para dependencias en cascada dentro de misma unidad
        for(const sem of unit.semestres)
          for(const cur of sem.cursos)
            if(estado.materias[cur.id]) allAprobados[cur.id]=true;
      }

      // MODULOS
      const modulesSection = document.createElement('section');
      modulesSection.className = "unit-section";
      const mh = document.createElement('h2');
      mh.className = "unit-title";
      mh.innerText = "Módulos";
      modulesSection.appendChild(mh);
      const modulesList = document.createElement('div');
      modulesList.className = "modules-list";
      for(let k=0;k<modulos.length;k++){
        const md = modulos[k];
        const modcol = document.createElement('div');
        modcol.className = "module-col";
        const moduleTitle = document.createElement('div');
        moduleTitle.className = "module-title";
        moduleTitle.setAttribute('data-mod', md.blockKey);
        moduleTitle.innerText = md.block;
        modcol.appendChild(moduleTitle);
        for(let m=0;m<md.cursos.length;m++){
          const mod = md.cursos[m];
          const divm = document.createElement('div');
          divm.className = "module-course";
          let bloqueada = false, tooltip = '';
          const faltan = isLocked(mod, allAprobados);
          if (Array.isArray(faltan) && faltan.length>0){
            bloqueada = true;
            divm.classList.add("locked");
            tooltip = 'Falta(n):\n'+faltan.map(fid=>'· '+nombreById(fid)).join('\n');
          }
          if(estado.modulos[mod.id]) divm.classList.add("approved");
          // icon, nombre, créditos
          divm.innerHTML = `<span class="icon">${mod.icon||""}</span> ${mod.n} <span class="cr" title="Créditos">${Number(mod.credit).toFixed(2)}</span>`;
          if(bloqueada)
            divm.innerHTML += `<span class="tooltip">${tooltip}</span>`;
          divm.addEventListener('click',e=>{
            if(bloqueada) return;
            estado.modulos[mod.id]= !estado.modulos[mod.id];
            saveEstado(); renderMalla();
          });
          modcol.appendChild(divm);
        }
        modulesList.appendChild(modcol);
      }
      modulesSection.appendChild(modulesList);
      unitsOut.push(modulesSection);

      // limpiar y agregar al DOM
      const unitsDiv = document.querySelector('.units');
      unitsDiv.innerHTML = "";
      for(const sect of unitsOut){
        unitsDiv.appendChild(sect);
      }
    }

    // ---- ACTUALIZA ESTADÍSTICAS ----
    function renderMalla() {
      generarMalla();
      document.getElementById('mat-ap').querySelector('b').innerText = cursosAprobados();
      document.getElementById('mod-ap').querySelector('b').innerText = modAprobados();
      document.getElementById('credit-ap').querySelector('b').innerText = sumCreditos().toFixed(2);
    }

    // RESET / inicio limpio
    if(window.location.hash==="#reset") { localStorage.removeItem('malla-turismo'); }

    // --- INICIO ---
    renderMalla();
  </script>
</body>
</html>
